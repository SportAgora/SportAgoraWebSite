<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Local</title>
    <link rel="stylesheet" href="/css/adm/novousuario.css">
    <link rel="stylesheet" href="/css/adm/styles.css">
    <link rel="stylesheet" href="/css/erro.css">
    <link rel="icon" href="/imagens/SportAgora.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
    <script src="/js/notify.js"></script>   

   
</head>
<body>
    <%- include('../../partials/adm_navbar'); %>
    <%
    let erroValidacao = {
        nome: "", endereco: "", foto: "", latitude: "", longitude: "", esportes: ""
    };
    let msgErro = "";  // Alterado para string (igual ao primeiro exemplo)
    if (erros) {
        erros.errors.forEach(function(erro) {
            if (erro.path in erroValidacao) {
                erroValidacao[erro.path] = "erro";
                msgErro += `* ${erro.msg} <br>`;  // Concatenando erro na variável msgErro
            }
        });
    }
    if (msgErro != "") {  // Este "if" fecha corretamente
        %>
        <script>
            let msgErro = "<%= msgErro %>";
            notify("Erro(s) no preenchimento", 
            "Verifique o(s) campo(s) <br> " + msgErro.replace(/&lt;/g, "<").replace(/&gt;/g, ">"), 
            "error", "right bottom", 5000);
        </script>
        <%
    }
    if (dadosNotificacao) {  // Este if também é necessário
        %>
        <script>
            notify("<%= dadosNotificacao.titulo%>","<%= dadosNotificacao.mensagem%>", "<%= dadosNotificacao.tipo%>", "right bottom")  
        </script>
    <% } %>  <!-- Aqui termina o bloco de dadosNotificacao -->
    <main>
        <section id="logo-area">
            <h1 class="tituloLogo">Editar Local</h1>
        </section>
        
        <%- console.log("Noti: ",dadosNotificacao) %>
        <%- console.log("Erros: ",msgErro) %>
        <form id="formulario-local" method="POST" action="/adm/local_editar?id=<%= dados.local_id %>" enctype="multipart/form-data">
            <input type="hidden" name="id" value="<%= dados.local_id %>">

            <!-- Nome -->
            <label for="nome">Nome do Local:</label>
            <input type="text" id="nome" name="nome" value="<%= dados.local_nome || '' %>" class="<%= erroValidacao.nome %>" required>
            <span class="spanerro"><%= msgErro.nome %></span><br>

            <!-- Endereço -->
            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" name="endereco" value="<%= dados.local_endereco || '' %>" class="<%= erroValidacao.endereco %>" required>
            <span class="spanerro"><%= msgErro.endereco %></span><br>

            <!-- Foto -->
            <label for="foto">Foto do Local:</label>
            <% if (dados.local_foto) { %>
                <div class="foto-preview">
                    <img src="/<%= dados.local_foto %>" alt="Foto do Local" style="max-width:200px; display:block; margin-bottom:5px;">
                </div>
                <input type="hidden" name="fotoAntiga" value="<%= dados.local_foto %>">
            <% } %>
            <input type="file" id="foto" name="foto" class="<%= erroValidacao.foto %>" accept="image/*">
            <span class="spanerro"><%= msgErro.foto %></span><br>

            <!-- Latitude -->
            <label for="latitude">Latitude:</label>
            <input type="text" id="latitude" name="latitude" value="<%= dados.local_latitude || '' %>" class="<%= erroValidacao.latitude %>" required>
            <span class="spanerro"><%= msgErro.latitude %></span><br>

            <!-- Longitude -->
            <label for="longitude">Longitude:</label>
            <input type="text" id="longitude" name="longitude" value="<%= dados.local_longitude || '' %>" class="<%= erroValidacao.longitude %>" required>
            <span class="spanerro"><%= msgErro.longitude %></span><br>

            <!-- Esportes -->
            <label>Esportes disponíveis:</label>
            <div class="checkbox-group <%= erroValidacao.esportes %>">
                <% esportes.forEach(function(esporte){ %>
                    <div class="checkbox-item">
                        <input 
                            type="checkbox" 
                            id="esporte_<%= esporte.esporte_id %>" 
                            name="esportes[]" 
                            value="<%= esporte.esporte_id %>"
                            <%= dados.esportesSelecionados && dados.esportesSelecionados.includes(esporte.esporte_id) ? "checked" : "" %>>
                        <label for="esporte_<%= esporte.esporte_id %>"><%= esporte.esporte_nome %></label>
                    </div>
                <% }) %>
            </div>
            <span class="spanerro"><%= msgErro.esportes %></span><br><br>

            <!-- Botão -->
            <button type="submit" class="enviar-btn">Salvar Alterações</button>
        </form>
    </main>

    <%- include('../../partials/adm_footer'); %>
</body>
</html>
