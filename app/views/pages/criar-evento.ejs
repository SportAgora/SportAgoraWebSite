<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagamento Do</title>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/criar-evento.css">
  <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-regular-rounded/css/uicons-regular-rounded.css'>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
  <link rel="icon" href="imagens/SportAgora.png">
  <script defer src="/js/script.js"></script>

   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
    <script src="/js/notify.js"></script>
</head>

<body>
  <%- include('../partials/navbar'); %>

  <header class="container-ver-eventos">
    <button class="botao-seta" onclick="window.history.back()">
      <img src="/imagens/left-arrow.png" alt="Seta">
    </button>
    <span class="ver-eventos">Voltar</span>
  </header>

  <main>

    <% 
    console.log(dados.foto)

    let avisoErro = {
        nome:"", 
        foto:"", 
        data_hora:"", 
        descricao:"", 
        cep:"", 
        numero:"", 
        complemento:""
    };

    let msgErro = "";
    if(erros){
        erros.errors.forEach(function(erro){
            switch(erro.path){
                case "nome":
                    avisoErro.nome = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
                case "foto":
                    avisoErro.foto = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
                case "data":
                    avisoErro.data_hora = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
                case "hora":
                    avisoErro.data_hora = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
                case "descricao":
                    avisoErro.descricao = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
                case "cep":
                    avisoErro.cep = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
                case "numero":
                    avisoErro.numero = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
                case "complemento":
                    avisoErro.complemento = "erro";
                    msgErro += `* ${erro.msg} <br>`;
                    break;
            }
        });
    }

    if(msgErro != ""){
    %>
    <script>
        let msgErro = "<%= msgErro %>";
        notify(
            "Erro(s) no preenchimento", 
            "Verifique o(s) campo(s) <br> " + msgErro.replace(/&lt;/g,"<").replace(/&gt;/g,">"), 
            "error", 
            "right bottom", 
            5000
        );                        
    </script>
    <% }
      if (dadosNotificacao) { %>
    <script>
        notify(
            "<%= dadosNotificacao.titulo %>",
            "<%= dadosNotificacao.mensagem %>",
            "<%= dadosNotificacao.tipo %>",
            "right bottom"
        );                    
    </script>
    <% } %>


    <form id="evento-form" method="POST"  enctype="multipart/form-data" action="/criar-evento">
      
      <section class="container">
        <h1>1. Informações básicas</h1>
        <p class="subtitle">Adicione as principais informações do evento.</p>

        <label>Nome do evento *</label>
        <input type="text" name="nome" id="nome" maxlength="100" value="<%= dados.nome %>" >
        
        <label>Imagem de divulgação</label>
        <figure class="image-upload" id="image-drop">
        <!-- texto aparece só se não houver imagem -->
        <figcaption id="image-text" style="<%= dados && dados.foto ? 'display:none;' : 'display:block;' %>">
          Clique ou arraste a imagem aqui
        </figcaption>

        <!-- input de upload -->
        <input type="file" name="foto" accept="image/*" id="image-input" style="display:none;">

        <!-- preview da imagem -->
        <img 
          id="image-preview" 
          src="<%= dados && dados.foto ? '/' + dados.foto : '' %>" 
          alt="Preview" 
          style="<%= dados && dados.foto ? 'display:block;' : 'display:none;' %>; max-width: 100%; margin-top: 10px;"
        >
        <!-- campo escondido pra manter a foto antiga -->
        <input type="hidden" name="fotoAntiga" value="<%= dados && dados.foto ? dados.foto : '' %>">
      </figure>



        <label>Classifique seu evento</label>
        <article class="classification">
          <section>
            <label>Esporte *</label>
            <select name = "esporte" id = "esporte" >
              <% if(esporte) { %>
                        <% esporte.forEach(function(a) { %>
                            <option value="<%= a.esporte_id%>"><%= a.esporte_nome %></option>
                        <% }); %>
                      <% } else { %>
                        <option value="" disabled selected>Nenhuma opção</option>
                      <% } %>
            </select>
          </section>
        </article>
      </section>

      <section class="container">
        <h1>2. Data e horário</h1>
        <p class="subtitle">Informe aos participantes quando seu evento vai acontecer.</p>

        <article class="datetime">
          

          <section>
            <label>Data do evento *</label>
            <input name="data" type="date" value="<%= dados.data || '' %>">
          </section>
          
          <section>
            <label>Horário de início do evento *</label>
            <input name="hora" type="time" value="<%= dados.hora || '' %>">
          </section>

          <br>
          
        </article>
      </section>

      <section class="container">
        <h1>3. Descrição do evento</h1>
        <p class="subtitle">Conte todos os detalhes do seu evento, como a programação e os diferenciais da sua produção!</p>

        <section id="editor-container">
          <section id="toolbar">
            <span class="ql-formats">
              <select class="ql-font"></select>
              <select class="ql-size"></select>
            </span>
            <span class="ql-formats">
              <button class="ql-bold"></button>
              <button class="ql-italic"></button>
              <button class="ql-underline"></button>
              <button class="ql-strike"></button>
            </span>
            <span class="ql-formats">
              <select class="ql-color"></select>
              <select class="ql-background"></select>
            </span>
            <span class="ql-formats">
              <button class="ql-list" value="ordered"></button>
              <button class="ql-list" value="bullet"></button>
              <button class="ql-indent" value="-1"></button>
              <button class="ql-indent" value="+1"></button>
            </span>
            <span class="ql-formats">
              <button class="ql-clean"></button>
            </span>
          </section>

          <section id="editor" style="height: 300px;"></section>
        </section>
      </section>

      <section class="container">
        <h1>4. Onde o seu evento vai acontecer?</h1>
        <input type="hidden" name="descricao" id="descricao" value="<%= dados.descricao || '' %>">
        <article class="location-fields">
          <legend class="visually-hidden">Localização do evento</legend>

          <label>CEP</label>
            <input type="text" id="cep" name="cep" placeholder="00000-000" value="<%= dados.cep || '' %>">

            <section id="spinner" style="display:none; font-size:.9rem;">Buscando CEP…</section>

            <label>Rua</label>
            <input type="text" id="rua" name="rua" readonly>

            <label>Número</label>
            <input type="text" id="numero" name="numero" value="<%= dados.numero || '' %>">

            <label>Complemento</label>
            <input type="text" id="complemento" name="complemento" value="<%= dados.complemento || '' %>">

            <label>Bairro</label>
            <input type="text" id="bairro" name="bairro" readonly>

            <label>Cidade</label>
            <input type="text" id="cidade" name="cidade" value="<%= dados.cidade || '' %>" readonly>

            <label>Estado</label>
            <input type="text" id="estado" name="uf" value="<%= dados.uf || '' %>"readonly>
        </article>
      </section>

      <section class="container">
        <h1>5. Ingressos</h1>
        <p>Que tipo de ingresso você deseja criar?</p>
        <legend>Atenção: estes dados NÃO podem ser alterados mais tarde devido as diretrizes de valores.</legend>
        <label>Nome do ingresso</label>
        <input type="text" id="nome-ingresso">

        <label>Valor</label>
        <input type="number" id="valor-ingresso" step="0.01">

        <label>Quantidade</label>
        <input type="number" id="quantidade-ingresso" step="1" min="1"> 

        <button type="button" id="meia-entrada" class="meia-btn">Adicionar meia-entrada</button>
        <button type="button" id="publicar-ingresso" class="public-btn">Publicar ingresso</button>

        <section id="ingresso-tabela-wrapper">
          <table id="ingresso-tabela">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Valor</th>
                <th>Quantidade</th>
                <th>Meia-entrada</th>
              </tr>
            </thead>
            <tbody>
              
            </tbody>
          </table>
        </section>

        <section class="center">
          <input type="submit" id="publicar-evento" value="Publicar evento">
        </section>
      </section>

    </form>
  </main>
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script defer src="/js/criar-evento.js"></script>
  
    <%- include('../partials/footer'); %>
</body>
</html>
